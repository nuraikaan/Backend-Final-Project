<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catalog â€“ Cosmo</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="style.css" />

  <style>
    .card img {
      height: 260px;
      object-fit: cover;
    }
    .badge-admin {
      background: #d81e5b;
      font-size: 0.75rem;
    }
  </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand text-pink fw-bold" href="catalog.html">Cosmo</a>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="catalog.html">Catalog</a></li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-favorites" href="favorites.html">Favorites</a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-cart" href="cart.html">Cart</a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-admin" href="admin.html">Admin</a>
        </li>
        <li class="nav-item"><a class="nav-link" id="nav-login" href="login.html">Login</a></li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-logout" href="#" onclick="logout()">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container my-5">
  <h2 class="mb-4 text-center"> All Products</h2>

  <div class="row g-4" id="products-container"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="app.js"></script>

<script>
async function loadCatalog() {
  try {
    const res = await fetch(`${API}/products`);
    const products = await res.json();

    const container = document.getElementById('products-container');
    container.innerHTML = '';

    const isAdmin = localStorage.getItem('role') === 'admin';

    products.forEach(p => {
      const col = document.createElement('div');
      col.className = 'col-sm-6 col-md-4 col-lg-3';

      col.innerHTML = `
  <div class="card h-100 shadow-sm">
    <img src="${p.imageUrl}" class="card-img-top">

    <div class="card-body d-flex flex-column">
      <h5 class="card-title">${p.name}</h5>

      <p class="fw-bold text-pink">$${p.price}</p>

      <p class="small text-${p.inStock ? 'success' : 'danger'}">
        ${p.inStock ? 'In Stock' : 'Out of Stock'}
      </p>

      <button
        class="btn btn-outline-pink btn-sm mb-2 mt-auto"
        onclick="addToFavorites('${p._id}')">
        â™¡ Add to Favorites
      </button>

      <button
        class="btn btn-outline-dark btn-sm"
        onclick="addToCart('${p._id}')">
        ðŸ›’ Add to Cart
      </button>

    </div>
  </div>
`;

      container.appendChild(col);
    });

  } catch (err) {
    alert('Failed to load products');
  }
}

async function deleteProduct(id) {
  if (!confirm('Delete this product?')) return;

  await fetchWithAuth(`${API}/products/${id}`, {
    method: 'DELETE'
  });

  loadCatalog();
}

function editProduct(id) {
  location.href = `admin.html?edit=${id}`;
}

document.addEventListener('DOMContentLoaded', () => {
  updateNav();
  loadCatalog();
});
</script>
</body>
</html>
