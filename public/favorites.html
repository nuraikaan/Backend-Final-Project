<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Favorites â€“ Cosmo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="navbar navbar-expand-lg bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand text-pink fw-bold" href="catalog.html">Cosmo</a>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="catalog.html">Catalog</a></li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-favorites" href="favorites.html">Favorites</a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-cart" href="cart.html">Cart</a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-admin" href="admin.html">Admin</a>
        </li>
        <li class="nav-item"><a class="nav-link" id="nav-login" href="login.html">Login</a></li>
        <li class="nav-item">
          <a class="nav-link d-none" id="nav-logout" href="#" onclick="logout()">Logout</a>
        </li>
      </ul>
    </div>
</nav>

<div class="container my-5">
  <h2>My Favorite Products</h2>
  <div class="row g-4" id="favorites-container"></div>
  
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html><script src="app.js"></script>
<script>
async function loadFavorites() {
  if (!getToken()) {
    alert('Please login');
    location.href = 'login.html';
    return;
  }

  try {
    const res = await fetchWithAuth(`${API}/favorites`);
    if (!res.ok) throw new Error();

    const products = await res.json();
    const c = document.getElementById('favorites-container');
    c.innerHTML = '';

    if (!products.length) {
      c.innerHTML = '<p class="text-muted">No favorites yet</p>';
      return;
    }

    products.forEach(p => {
      const div = document.createElement('div');
      div.className = 'col-md-6 col-lg-4';
      div.innerHTML = `
        <div class="card h-100 shadow-sm">
          <img src="${p.imageUrl}" class="card-img-top">
          <div class="card-body">
            <h5>${p.name}</h5>
            <p class="fw-bold text-pink">$${p.price.toFixed(2)}</p>
            <button class="btn btn-outline-danger btn-sm"
              onclick="removeFavorite('${p._id}', this)">
              Remove
            </button>
          </div>
        </div>
      `;
      c.appendChild(div);
    });
  } catch {
    alert('Failed to load favorites');
  }
}

async function removeFavorite(productId, btn) {
  if (!confirm('Remove from favorites?')) return;

  try {
    const res = await fetchWithAuth(`${API}/favorites/${productId}`, {
      method: 'DELETE'
    });

    if (res.ok) {
      btn.closest('.col-md-6').remove();
    } else {
      alert('Error removing');
    }
  } catch {
    alert('Network error');
  }
}

document.addEventListener('DOMContentLoaded', () => {
  updateNav();
  loadFavorites();
});
</script>
